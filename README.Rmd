---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# movies-dataset

<!-- badges: start -->

<!-- badges: end -->

```{r, message=FALSE}
library(tidyverse)
```

The `movies-dataset` repository contains data scraped from <https://letterboxd.com/>

`download/00-get-users.R` creates the `users.rds` file, which contains user-level information on the 7,500 most popular users of all time.

```{r}
users <- read_rds("download/users.rds")
glimpse(users)
```

The information contain in the `href` variable was then used to scrape ratings-per user with the `download/01-get-ratings-from-users.R` script. This data is stored in the `user_ratings.rds` file.

```{r}
user_ratings <- read_rds("download/user_ratings.rds")
glimpse(user_ratings)
```

Number of movies in the subset:

```{r}
length(unique(user_ratings$data_film_slug))
```

Number of users in the subset:

```{r}
length(unique(user_ratings$href))
```

*Note. When I'm finished scraping, this should be roughly equal to 7500. As of `r lubridate::today()`, the number of users with data represents `r scales::percent(length(unique(user_ratings$href)) / nrow(users), accuracy = 0.001)` of the total users.*

Example:

```{r,  message=FALSE, warning=FALSE}
metadata <- read_rds("download/metadata.rds")

user_ratings |> 
  nest(data = !data_film_slug) |> 
  mutate(n = map_dbl(data, nrow)) |> 
  slice_head(n = 15) |> 
  unnest(cols = "data") |> 
  left_join(select(metadata, data_film_slug, alt), by = "data_film_slug") |> 
  ggplot(aes(rating)) + 
  geom_bar(width = 1/5) + 
  facet_wrap(~alt, ncol = 3)
```

------------------------------------------------------------------------

*We should also add other types of metadata per movie, like date and genre.*

*Note, there's currently an API in beta. We should consider applying for this so that the data becomes "legal."*

-   <https://letterboxd.com/api-beta/>
-   <https://api-docs.letterboxd.com/>
